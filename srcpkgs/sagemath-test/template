# Template file for 'sagemath-test'
pkgname=sagemath-test
version=1
revision=1
build_style=meta
checkdepends="sagemath"
short_desc="Dummy package to test sagemath"
maintainer="Gonzalo Tornar√≠a <tornaria@cmat.edu.uy>"
license="GPL-2.0-or-later"
homepage="none"

# TODO: install base-voidstrap, uninstall base-chroot, and remove orphans
# so we can check sagemath depends are enough to run sage on void

do_check() {
	if [ -f ${XBPS_DISTDIR}/sagemath-check ] ; then
		_test_files=$(sed -e 's/#.*//;/^\s*$/d' ${XBPS_DISTDIR}/sagemath-check)
	fi
	if [ -z "$_test_files" ]; then
		_test_files=--all
	fi
	cp ${FILESDIR}/timings2.json .
	_test_args="--stats_path=timings2.json"
	if [ "$XBPS_CHECK_PKGS" = full ]; then
		_test_args+=" --long --warn-long 60.0"
	else
		_test_args+=" --warn-long 30.0"
	fi
	if [ "$XBPS_BUILD_ENVIRONMENT" = "void-packages-ci" ]; then
		# for CI use a predictable random seed
		_test_args+=" --random-seed=0"
	fi
	# since make check will build the docs, run test like this instead
	sage -tp ${XBPS_MAKEJOBS} ${_test_args} ${_test_files}
}
