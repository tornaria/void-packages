# Template file for 'sagemath-test'
pkgname=sagemath-test
version=1
revision=1
build_style=meta
checkdepends="sagemath"
short_desc="Dummy package to test sagemath"
maintainer="Gonzalo Tornar√≠a <tornaria@cmat.edu.uy>"
license="GPL-2.0-or-later"
homepage="none"

# TODO: install base-voidstrap, uninstall base-chroot, and remove orphans
# so we can check sagemath depends are enough to run sage on void

do_check() {
	if [ -f ${XBPS_DISTDIR}/sagemath-check ] ; then
		_test_args=$(sed -e 's/#.*//;/^\s*$/d' ${XBPS_DISTDIR}/sagemath-check)
	fi
	if [ -z "$_test_args" ]; then
		_test_args=--all
	fi
	if [ "$XBPS_BUILD_ENVIRONMENT" = void-packages-ci ]; then
		# for CI use a predictable random seed
		_test_args="--random-seed=0 $_test_args"
	fi
	if [ "$XBPS_CHECK_PKGS" = full ]; then
		_test_args="--long $_test_args"
	else
		_test_args="--warn-long 5.0 $_test_args"
	fi
	sage -tp ${XBPS_MAKEJOBS} ${_test_args}
}
