From fe947f3c9a6109b92dd4c19dda795ceb01c6f9a7 Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 24 Nov 2021 18:23:16 -0800
Subject: build/pkgs/ipython: Update to 7.29.0

---
 build/pkgs/ipython/checksums.ini       | 6 +++---
 build/pkgs/ipython/package-version.txt | 2 +-
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/build/pkgs/ipython/checksums.ini b/build/pkgs/ipython/checksums.ini
index aa743ea..03da012 100644
--- a/build/pkgs/ipython/checksums.ini
+++ b/build/pkgs/ipython/checksums.ini
@@ -1,5 +1,5 @@
 tarball=ipython-VERSION.tar.gz
-sha1=a64001602601a4a7917a32b496543153f82dd65a
-md5=e28a91669dc8b86569a99abed2c67f08
-cksum=4064786540
+sha1=05165e7fdcebde908aa6b65892ef230795a01e6b
+md5=159340b8ba158386f938a8b882749fed
+cksum=1960065579
 upstream_url=https://pypi.io/packages/source/i/ipython/ipython-VERSION.tar.gz
diff --git a/build/pkgs/ipython/package-version.txt b/build/pkgs/ipython/package-version.txt
index f6b1800..d88eca0 100644
--- a/build/pkgs/ipython/package-version.txt
+++ b/build/pkgs/ipython/package-version.txt
@@ -1 +1 @@
-7.27.0
+7.29.0
-- 
cgit v1.0-1-gd88e


From 7939a79de125c7f20e981b31c0124e1d80ec9e42 Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 24 Nov 2021 18:28:14 -0800
Subject: build/pkgs/ipykernel: Update to 6.5.1

---
 build/pkgs/ipykernel/checksums.ini       | 6 +++---
 build/pkgs/ipykernel/package-version.txt | 2 +-
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/build/pkgs/ipykernel/checksums.ini b/build/pkgs/ipykernel/checksums.ini
index 51eb667..ca1302e 100644
--- a/build/pkgs/ipykernel/checksums.ini
+++ b/build/pkgs/ipykernel/checksums.ini
@@ -1,5 +1,5 @@
 tarball=ipykernel-VERSION.tar.gz
-sha1=19b16c61057bb7f5ad97f7e91bb54cdfec260257
-md5=329c172babb38dff1be130ddf3a609af
-cksum=2936157099
+sha1=2c2aa0e929bfd0e694da6b45d2de846a0a5d2812
+md5=78797cb2389d8f131c75280f808aac15
+cksum=1454395629
 upstream_url=https://pypi.io/packages/source/i/ipykernel/ipykernel-VERSION.tar.gz
diff --git a/build/pkgs/ipykernel/package-version.txt b/build/pkgs/ipykernel/package-version.txt
index dc0208a..a194c18 100644
--- a/build/pkgs/ipykernel/package-version.txt
+++ b/build/pkgs/ipykernel/package-version.txt
@@ -1 +1 @@
-6.3.1
+6.5.1
-- 
cgit v1.0-1-gd88e


From 73df3fc22ba3455befb05758f813caa3dd0a010b Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 24 Nov 2021 18:28:44 -0800
Subject: build/pkgs/ipywidgets: Update to 7.6.5

---
 build/pkgs/ipywidgets/checksums.ini       | 6 +++---
 build/pkgs/ipywidgets/package-version.txt | 2 +-
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/build/pkgs/ipywidgets/checksums.ini b/build/pkgs/ipywidgets/checksums.ini
index efb9fe9..af4a04d 100644
--- a/build/pkgs/ipywidgets/checksums.ini
+++ b/build/pkgs/ipywidgets/checksums.ini
@@ -1,5 +1,5 @@
 tarball=ipywidgets-VERSION.tar.gz
-sha1=8ea8c8e15a4779897dc9f12cc20e29cfe5fb689f
-md5=771fd3999f93af336c6e40ae1f5c37a2
-cksum=980834502
+sha1=ad63e99f44fd759c34ab70161e9ac8f4276294f8
+md5=420aabfddee27fc215ad9a9c14c9c529
+cksum=259379988
 upstream_url=https://pypi.io/packages/source/i/ipywidgets/ipywidgets-VERSION.tar.gz
diff --git a/build/pkgs/ipywidgets/package-version.txt b/build/pkgs/ipywidgets/package-version.txt
index b7ade06..bf43f75 100644
--- a/build/pkgs/ipywidgets/package-version.txt
+++ b/build/pkgs/ipywidgets/package-version.txt
@@ -1 +1 @@
-7.6.4.p0
+7.6.5
-- 
cgit v1.0-1-gd88e


From 5e144e95b13005cfb2cd7e3a3b7abd70d0a902c7 Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 24 Nov 2021 18:30:04 -0800
Subject: build/pkgs/jedi: Update to 0.18.1

---
 build/pkgs/jedi/checksums.ini       | 6 +++---
 build/pkgs/jedi/package-version.txt | 2 +-
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/build/pkgs/jedi/checksums.ini b/build/pkgs/jedi/checksums.ini
index f5be931..2db629c 100644
--- a/build/pkgs/jedi/checksums.ini
+++ b/build/pkgs/jedi/checksums.ini
@@ -1,5 +1,5 @@
 tarball=jedi-VERSION.tar.gz
-sha1=f9acd323b88563fafb5bb4dff592794a2713a15c
-md5=72707c00e8d6d0b190a5e5664be1cac5
-cksum=620165561
+sha1=e94444bd83b55247fd1f3d27d47cc0b148560134
+md5=d8dba4a98a35530f7f5b461c20aff180
+cksum=4093067035
 upstream_url=https://pypi.io/packages/source/j/jedi/jedi-VERSION.tar.gz
diff --git a/build/pkgs/jedi/package-version.txt b/build/pkgs/jedi/package-version.txt
index 6633391..249afd5 100644
--- a/build/pkgs/jedi/package-version.txt
+++ b/build/pkgs/jedi/package-version.txt
@@ -1 +1 @@
-0.18.0
+0.18.1
-- 
cgit v1.0-1-gd88e


From 6347f984a697b3aecfe0ed6d2f7363c9dc3b5b65 Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 24 Nov 2021 18:30:58 -0800
Subject: build/pkgs/prompt_toolkit: Update to 3.0.22

---
 build/pkgs/prompt_toolkit/checksums.ini       | 6 +++---
 build/pkgs/prompt_toolkit/package-version.txt | 2 +-
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/build/pkgs/prompt_toolkit/checksums.ini b/build/pkgs/prompt_toolkit/checksums.ini
index 7868d1a..0e3fe14 100644
--- a/build/pkgs/prompt_toolkit/checksums.ini
+++ b/build/pkgs/prompt_toolkit/checksums.ini
@@ -1,5 +1,5 @@
 tarball=prompt_toolkit-VERSION.tar.gz
-sha1=20fe2a6126ee2b992d9f77cd20e4b80626b036d7
-md5=ba9e63c3e7e5a4f4ce4e4770a4daba96
-cksum=3647925903
+sha1=5efb27677b89b2c81241645c6658e60771af3b7b
+md5=bbaeba1142a64ecf2264eaf4f85201b1
+cksum=1605705668
 upstream_url=https://pypi.io/packages/source/p/prompt_toolkit/prompt_toolkit-VERSION.tar.gz
diff --git a/build/pkgs/prompt_toolkit/package-version.txt b/build/pkgs/prompt_toolkit/package-version.txt
index 3e4a61b..6795d4d 100644
--- a/build/pkgs/prompt_toolkit/package-version.txt
+++ b/build/pkgs/prompt_toolkit/package-version.txt
@@ -1 +1 @@
-3.0.20
+3.0.22
-- 
cgit v1.0-1-gd88e


From 28e535d3a1dd6b67e740b1900c4fad36cccd1121 Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 24 Nov 2021 18:32:02 -0800
Subject: build/pkgs/widgetsnbextension: Update to 3.5.2

---
 build/pkgs/widgetsnbextension/checksums.ini       | 6 +++---
 build/pkgs/widgetsnbextension/package-version.txt | 2 +-
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/build/pkgs/widgetsnbextension/checksums.ini b/build/pkgs/widgetsnbextension/checksums.ini
index 2f7e946..81205c5 100644
--- a/build/pkgs/widgetsnbextension/checksums.ini
+++ b/build/pkgs/widgetsnbextension/checksums.ini
@@ -1,5 +1,5 @@
 tarball=widgetsnbextension-VERSION.tar.gz
-sha1=f92ee894f3b08cfb6cfac0856d77521bbbf45e92
-md5=3dc5f96919c032a885950e3819bdee7b
-cksum=4195536255
+sha1=010f70ab9a6d6e0a4f9607cce0da182ee6c1280a
+md5=c126a06559afe658e285bcd483790710
+cksum=160710350
 upstream_url=https://pypi.io/packages/source/w/widgetsnbextension/widgetsnbextension-VERSION.tar.gz
diff --git a/build/pkgs/widgetsnbextension/package-version.txt b/build/pkgs/widgetsnbextension/package-version.txt
index ffe3090..87ce492 100644
--- a/build/pkgs/widgetsnbextension/package-version.txt
+++ b/build/pkgs/widgetsnbextension/package-version.txt
@@ -1 +1 @@
-3.5.1.p0
+3.5.2
-- 
cgit v1.0-1-gd88e


From 63078ac3e486d986d43e78f76a2037455147b8da Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 24 Nov 2021 18:33:12 -0800
Subject: build/pkgs/terminado: Update to 0.12.1

---
 build/pkgs/terminado/checksums.ini       | 6 +++---
 build/pkgs/terminado/package-version.txt | 2 +-
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/build/pkgs/terminado/checksums.ini b/build/pkgs/terminado/checksums.ini
index ba1b392..f33efd4 100644
--- a/build/pkgs/terminado/checksums.ini
+++ b/build/pkgs/terminado/checksums.ini
@@ -1,5 +1,5 @@
 tarball=terminado-VERSION.tar.gz
-sha1=9a4f75d9f1bad0e7eadf33da774ab4e09d75a47b
-md5=8150154423841a90b1d8ca60943ad84c
-cksum=2702442904
+sha1=65f40480c1d8077b78dcffb7e0c909eae86998bf
+md5=4871263f6aaed18e09603fa6785b4340
+cksum=2070178009
 upstream_url=https://pypi.io/packages/source/t/terminado/terminado-VERSION.tar.gz
diff --git a/build/pkgs/terminado/package-version.txt b/build/pkgs/terminado/package-version.txt
index af88ba8..34a8361 100644
--- a/build/pkgs/terminado/package-version.txt
+++ b/build/pkgs/terminado/package-version.txt
@@ -1 +1 @@
-0.11.1
+0.12.1
-- 
cgit v1.0-1-gd88e


From 22de5dc202d63cbcef3a752a6c68e7d99332d705 Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 24 Nov 2021 18:34:42 -0800
Subject: build/pkgs/notebook: Update to 6.4.6

---
 build/pkgs/notebook/checksums.ini       | 6 +++---
 build/pkgs/notebook/package-version.txt | 2 +-
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/build/pkgs/notebook/checksums.ini b/build/pkgs/notebook/checksums.ini
index 1355f59..29c39e9 100644
--- a/build/pkgs/notebook/checksums.ini
+++ b/build/pkgs/notebook/checksums.ini
@@ -1,5 +1,5 @@
 tarball=notebook-VERSION.tar.gz
-sha1=0a6d27e401d04d516c3851862491824007272dc0
-md5=718f7f0267e0111b4ef9ff3238e9f7e8
-cksum=2383141171
+sha1=93736a3a9c5b025f71a25a301b676a40aca3124b
+md5=ecb9319cf82a9a83b1c4c8e1cc4efbee
+cksum=1697144622
 upstream_url=https://pypi.io/packages/source/n/notebook/notebook-VERSION.tar.gz
diff --git a/build/pkgs/notebook/package-version.txt b/build/pkgs/notebook/package-version.txt
index 133cad2..3d05e8c 100644
--- a/build/pkgs/notebook/package-version.txt
+++ b/build/pkgs/notebook/package-version.txt
@@ -1 +1 @@
-6.4.3
+6.4.6
-- 
cgit v1.0-1-gd88e


From a0fe18ba460d87e0bd46ada9f4246baa49c7c251 Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 24 Nov 2021 18:35:36 -0800
Subject: build/pkgs/nbclient: Update to 0.5.4

---
 build/pkgs/nbclient/checksums.ini       | 6 +++---
 build/pkgs/nbclient/package-version.txt | 2 +-
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/build/pkgs/nbclient/checksums.ini b/build/pkgs/nbclient/checksums.ini
index 914ee93..b1f9790 100644
--- a/build/pkgs/nbclient/checksums.ini
+++ b/build/pkgs/nbclient/checksums.ini
@@ -1,5 +1,5 @@
 tarball=nbclient-VERSION.tar.gz
-sha1=9c1059878ae04da987ae00025908ae802cbfc066
-md5=593579773bd8128f845ea01a46ccbedb
-cksum=2389564342
+sha1=a5efba590429270c901f4f5a16c8b46a7e6b8e4a
+md5=a3cf8c1c121b0718a6ccf384c5683424
+cksum=2650264415
 upstream_url=https://pypi.io/packages/source/n/nbclient/nbclient-VERSION.tar.gz
diff --git a/build/pkgs/nbclient/package-version.txt b/build/pkgs/nbclient/package-version.txt
index 7d85683..416bfb0 100644
--- a/build/pkgs/nbclient/package-version.txt
+++ b/build/pkgs/nbclient/package-version.txt
@@ -1 +1 @@
-0.5.4
+0.5.9
-- 
cgit v1.0-1-gd88e


From ef3fc7f3a0877ee92dd1bf6e8d6e8c84db9f6050 Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 24 Nov 2021 18:38:02 -0800
Subject: build/pkgs/jupyter_client: Update to 7.1.0

---
 build/pkgs/jupyter_client/checksums.ini       | 6 +++---
 build/pkgs/jupyter_client/package-version.txt | 2 +-
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/build/pkgs/jupyter_client/checksums.ini b/build/pkgs/jupyter_client/checksums.ini
index ab486e6..cbe7b83 100644
--- a/build/pkgs/jupyter_client/checksums.ini
+++ b/build/pkgs/jupyter_client/checksums.ini
@@ -1,5 +1,5 @@
 tarball=jupyter_client-VERSION.tar.gz
-sha1=d03249e98f821ac8f43408e71b5390cef336d859
-md5=7c6ef694cde43fd365046869842a1cde
-cksum=236454943
+sha1=aad5dd5337e20e53de66e094092333e04d9c4e1d
+md5=33fb5eab82f3e89c68f2082b52a8e966
+cksum=481041414
 upstream_url=https://pypi.io/packages/source/j/jupyter_client/jupyter_client-VERSION.tar.gz
diff --git a/build/pkgs/jupyter_client/package-version.txt b/build/pkgs/jupyter_client/package-version.txt
index a8907c0..a3fcc71 100644
--- a/build/pkgs/jupyter_client/package-version.txt
+++ b/build/pkgs/jupyter_client/package-version.txt
@@ -1 +1 @@
-7.0.2
+7.1.0
-- 
cgit v1.0-1-gd88e


From a593bc993aa860f847b803a3d41fe7c2d5d99780 Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 24 Nov 2021 18:40:11 -0800
Subject: build/pkgs/jupyter_core: Update to 4.9.1

---
 build/pkgs/jupyter_core/checksums.ini       | 6 +++---
 build/pkgs/jupyter_core/package-version.txt | 2 +-
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/build/pkgs/jupyter_core/checksums.ini b/build/pkgs/jupyter_core/checksums.ini
index 8310cf0..f3a3068 100644
--- a/build/pkgs/jupyter_core/checksums.ini
+++ b/build/pkgs/jupyter_core/checksums.ini
@@ -1,5 +1,5 @@
 tarball=jupyter_core-VERSION.tar.gz
-sha1=01e57900f8e4475fb90ae533cf7ebd6f4c323867
-md5=adc204a306a7122a61aa742ccc4c252a
-cksum=1333962761
+sha1=afa48d85b3611beb42236be3c130767a6524ccfd
+md5=77a1e7642abfb834a6046e14b94f5c88
+cksum=1811078933
 upstream_url=https://pypi.io/packages/source/j/jupyter_core/jupyter_core-VERSION.tar.gz
diff --git a/build/pkgs/jupyter_core/package-version.txt b/build/pkgs/jupyter_core/package-version.txt
index 7c66fca..5b341fd 100644
--- a/build/pkgs/jupyter_core/package-version.txt
+++ b/build/pkgs/jupyter_core/package-version.txt
@@ -1 +1 @@
-4.7.1
+4.9.1
-- 
cgit v1.0-1-gd88e


From 66c16b14f9081c6d62f5d105cfe76b470074c187 Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 24 Nov 2021 18:41:20 -0800
Subject: build/pkgs/importlib_metadata: Update to 4.8.2

---
 build/pkgs/importlib_metadata/checksums.ini       | 6 +++---
 build/pkgs/importlib_metadata/package-version.txt | 2 +-
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/build/pkgs/importlib_metadata/checksums.ini b/build/pkgs/importlib_metadata/checksums.ini
index 4006b51..d5a9b1a 100644
--- a/build/pkgs/importlib_metadata/checksums.ini
+++ b/build/pkgs/importlib_metadata/checksums.ini
@@ -1,5 +1,5 @@
 tarball=importlib_metadata-VERSION.tar.gz
-sha1=1572500dd099439cbd86bb70bfe1d206fbc844f6
-md5=5b944bce3fccaf848f0cba7a07f850a1
-cksum=416853070
+sha1=7d15d8e06299a8f24e076600899aceee75ce8b0b
+md5=a605ba6ec315bc1324fd6b7210fe7c12
+cksum=448954927
 upstream_url=https://pypi.io/packages/source/i/importlib_metadata/importlib_metadata-VERSION.tar.gz
diff --git a/build/pkgs/importlib_metadata/package-version.txt b/build/pkgs/importlib_metadata/package-version.txt
index 697e993..326ec63 100644
--- a/build/pkgs/importlib_metadata/package-version.txt
+++ b/build/pkgs/importlib_metadata/package-version.txt
@@ -1 +1 @@
-4.8.1
+4.8.2
-- 
cgit v1.0-1-gd88e


From 27fbff02000609d9bf9c5f429b887e321148c6b6 Mon Sep 17 00:00:00 2001
From: Antonio Rojas <arojas@archlinux.org>
Date: Sun, 12 Dec 2021 09:57:10 +0100
Subject: Assign module property to test class

Otherwise, Python 3.10 will report a "source code not available" error, see https://github.com/python/cpython/commit/48a62559dfaf775e4f1cc56b19379c799e8e2587
---
 src/sage/misc/sageinspect.py | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/sage/misc/sageinspect.py b/src/sage/misc/sageinspect.py
index fb2073f..bd89233 100644
--- a/src/sage/misc/sageinspect.py
+++ b/src/sage/misc/sageinspect.py
@@ -1585,6 +1585,8 @@ def sage_getargspec(obj):
         ....:     'class Foo:\n'
         ....:     '    def __call__(self):\n'
         ....:     '        return None\n'
+        ....:     '    def __module__(self):\n'
+        ....:     '        return "sage.misc.sageinspect"\n'
         ....:     '    def _sage_src_(self):\n'
         ....:     '        return "the source code string"')
         sage: shell.run_cell('f = Foo()')
-- 
cgit v1.0-1-gd88e


From 26c9b33878aef88a0b1e88d6664823d9d4591a5f Mon Sep 17 00:00:00 2001
From: Antonio Rojas <arojas@archlinux.org>
Date: Sun, 12 Dec 2021 09:59:07 +0100
Subject: Add abs tol to some tests to make them pass with Python 3.10

---
 src/sage/plot/colors.py | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/src/sage/plot/colors.py b/src/sage/plot/colors.py
index 6fdba0f..f46b736 100644
--- a/src/sage/plot/colors.py
+++ b/src/sage/plot/colors.py
@@ -918,12 +918,12 @@ class Color(object):
 
             sage: Color(0.3, 0.5, 0.7, space='hls').hls()
             (0.30000000000000004, 0.5, 0.7)
-            sage: Color(0.3, 0.5, 0.7, space='hsl').hls()
+            sage: Color(0.3, 0.5, 0.7, space='hsl').hls() # abs tol 1e-15
             (0.30000000000000004, 0.7, 0.5000000000000001)
-            sage: Color('#aabbcc').hls()
+            sage: Color('#aabbcc').hls() # abs tol 1e-15
             (0.5833333333333334, 0.7333333333333334, 0.25000000000000017)
             sage: from sage.plot.colors import orchid
-            sage: orchid.hls()
+            sage: orchid.hls() # abs tol 1e-15
             (0.8396226415094339, 0.6470588235294117, 0.5888888888888889)
         """
         return tuple(map(float, rgb_to_hls(*self._rgb)))
@@ -942,9 +942,9 @@ class Color(object):
             sage: Color(1,0,0).hsl()
             (0.0, 1.0, 0.5)
             sage: from sage.plot.colors import orchid
-            sage: orchid.hsl()
+            sage: orchid.hsl() # abs tol 1e-15
             (0.8396226415094339, 0.5888888888888889, 0.6470588235294117)
-            sage: Color('#aabbcc').hsl()
+            sage: Color('#aabbcc').hsl() # abs tol 1e-15
             (0.5833333333333334, 0.25000000000000017, 0.7333333333333334)
         """
         h, l, s = tuple(map(float, rgb_to_hls(*self._rgb)))
-- 
cgit v1.0-1-gd88e


From 079ceca95e5d3ad9fb81d3234df3e984ddde09d4 Mon Sep 17 00:00:00 2001
From: Antonio Rojas <arojas@archlinux.org>
Date: Sun, 12 Dec 2021 09:59:43 +0100
Subject: Add missing space

Surprisingly, this didn't throw an error before Python 3.10
---
 src/sage/schemes/riemann_surfaces/riemann_surface.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/sage/schemes/riemann_surfaces/riemann_surface.py b/src/sage/schemes/riemann_surfaces/riemann_surface.py
index 3c3d387..f9d1e2b 100644
--- a/src/sage/schemes/riemann_surfaces/riemann_surface.py
+++ b/src/sage/schemes/riemann_surfaces/riemann_surface.py
@@ -1390,7 +1390,7 @@ class RiemannSurface(object):
             sage: S = RiemannSurface(f)
             sage: _ = S.homology_basis()
             sage: g,d = S.make_zw_interpolator([(0,0),(1,0)]);
-            sage: all(f(*g(i*0.1)).abs() < 1e-13for i in range(10))
+            sage: all(f(*g(i*0.1)).abs() < 1e-13 for i in range(10))
             True
             sage: abs((g(1)[0]-g(0)[0]) - d) < 1e-13
             True
-- 
cgit v1.0-1-gd88e


From 6603e290fff0e49a6394e40382c4ebdc8975049d Mon Sep 17 00:00:00 2001
From: Antonio Rojas <arojas@archlinux.org>
Date: Sun, 12 Dec 2021 10:00:49 +0100
Subject: Update some error messages to match Python 3.10 format

---
 src/sage/structure/unique_representation.py |  2 +-
 src/sage/symbolic/callable.py               | 10 +++++-----
 2 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/src/sage/structure/unique_representation.py b/src/sage/structure/unique_representation.py
index 9ead7a4..5d8d4ad 100644
--- a/src/sage/structure/unique_representation.py
+++ b/src/sage/structure/unique_representation.py
@@ -1221,7 +1221,7 @@ class UniqueRepresentation(CachedRepresentation, WithEqualityById):
         sage: isinstance(GF(7), GF)
         Traceback (most recent call last):
         ...
-        TypeError: isinstance() arg 2 must be a type or tuple of types
+        TypeError: isinstance() arg 2 must be a type...
 
         sage: isinstance(GF, sage.structure.factory.UniqueFactory)
         True
diff --git a/src/sage/symbolic/callable.py b/src/sage/symbolic/callable.py
index 5f3a7be..4b8efda 100644
--- a/src/sage/symbolic/callable.py
+++ b/src/sage/symbolic/callable.py
@@ -38,27 +38,27 @@ The arguments in the definition must be symbolic variables (:trac:`10747`)::
     sage: f(1)=2
     Traceback (most recent call last):
     ...
-    SyntaxError: can...t assign to function call
+    SyntaxError: can...t assign to function call...
 
     sage: f(x,1)=2
     Traceback (most recent call last):
     ...
-    SyntaxError: can...t assign to function call
+    SyntaxError: can...t assign to function call...
 
     sage: f(1,2)=3
     Traceback (most recent call last):
     ...
-    SyntaxError: can...t assign to function call
+    SyntaxError: can...t assign to function call...
 
     sage: f(1,2)=x
     Traceback (most recent call last):
     ...
-    SyntaxError: can...t assign to function call
+    SyntaxError: can...t assign to function call...
 
     sage: f(x,2)=x
     Traceback (most recent call last):
     ...
-    SyntaxError: can...t assign to function call
+    SyntaxError: can...t assign to function call...
 """
 
 import sage.rings.abc
-- 
cgit v1.0-1-gd88e


From f345263b8c46d72d12fb1d2482fbfbbd6f23a570 Mon Sep 17 00:00:00 2001
From: Antonio Rojas <arojas@archlinux.org>
Date: Sun, 12 Dec 2021 10:01:18 +0100
Subject: Make sure the timeout passed to select.select is a float

Python 3.10 does a type check
---
 src/sage/tests/cmdline.py | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/sage/tests/cmdline.py b/src/sage/tests/cmdline.py
index 4f16b0e..ba5aa14 100644
--- a/src/sage/tests/cmdline.py
+++ b/src/sage/tests/cmdline.py
@@ -766,6 +766,7 @@ def test_executable(args, input="", timeout=100.0, pydebug_ignore_warnings=False
             rfd.append(fderr)
         if len(rfd) == 0:
             break
+        timeout = float(timeout)
         rlist = select.select(rfd, [], [], timeout)[0]
 
         if len(rlist) == 0:
-- 
cgit v1.0-1-gd88e


From 2f13b8666aef7001b7464f7cf68d145a5752c067 Mon Sep 17 00:00:00 2001
From: Antonio Rojas <arojas@archlinux.org>
Date: Sun, 12 Dec 2021 18:30:05 +0100
Subject: Update another error message for Python 3.10

---
 src/sage/rings/asymptotic/growth_group.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/sage/rings/asymptotic/growth_group.py b/src/sage/rings/asymptotic/growth_group.py
index ba7e684..a91ec31 100644
--- a/src/sage/rings/asymptotic/growth_group.py
+++ b/src/sage/rings/asymptotic/growth_group.py
@@ -5434,7 +5434,7 @@ class GrowthGroupFactory(UniqueFactory):
             describing a growth group.
             > *previous* ValueError: Cannot create a parent out of 'as'.
             >> *previous* ValueError: unknown specification as
-            >> *and* SyntaxError: unexpected EOF while parsing (<string>, line 1)
+            >> *and* SyntaxError: ... (<string>, line 1)
             > *and* ValueError: Cannot create a parent out of 'df'.
             >> *previous* ValueError: unknown specification df
             >> *and* NameError: name 'df' is not defined
-- 
cgit v1.0-1-gd88e


From e65ae6ca71fbe284affeb4ed88e63acc97a3fe0a Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Mon, 24 May 2021 17:06:47 -0700
Subject: build/pkgs/python3/spkg-configure.m4: Accept system python 3.10.x

---
 build/pkgs/python3/spkg-configure.m4 | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/build/pkgs/python3/spkg-configure.m4 b/build/pkgs/python3/spkg-configure.m4
index df74019..3cbb994 100644
--- a/build/pkgs/python3/spkg-configure.m4
+++ b/build/pkgs/python3/spkg-configure.m4
@@ -1,7 +1,7 @@
 SAGE_SPKG_CONFIGURE([python3], [
    m4_pushdef([MIN_VERSION],               [3.7.0])
    m4_pushdef([MIN_NONDEPRECATED_VERSION], [3.7.0])
-   m4_pushdef([LT_VERSION],                [3.10.0])
+   m4_pushdef([LT_VERSION],                [3.11.0])
    AC_ARG_WITH([python],
                [AS_HELP_STRING([--with-python=PYTHON3],
                                [Python 3 executable to use for the Sage venv; default: python3])])
-- 
cgit v1.0-1-gd88e


From 59173d01b4ed85077a847d2643c80bb3499c926a Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Wed, 15 Sep 2021 17:49:12 -0700
Subject: pkgs/sage-setup/setup.cfg: Allow Python 3.10

---
 pkgs/sage-setup/setup.cfg | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/pkgs/sage-setup/setup.cfg b/pkgs/sage-setup/setup.cfg
index a1710d4..197fc67 100644
--- a/pkgs/sage-setup/setup.cfg
+++ b/pkgs/sage-setup/setup.cfg
@@ -31,7 +31,7 @@ packages =
     sage_setup.autogen.interpreters.specs
     sage_setup.command
 
-python_requires = >=3.7, <3.10
+python_requires = >=3.7, <3.11
 
 install_requires =
     pkgconfig
-- 
cgit v1.0-1-gd88e


From c902b7bc44c1b2116416962ec1194b8e59f11f06 Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Fri, 17 Dec 2021 09:15:25 -0800
Subject: src/setup.cfg.m4: Allow Python 3.10

---
 src/setup.cfg.m4 | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/setup.cfg.m4 b/src/setup.cfg.m4
index 16f88f2..b8bd0c0 100644
--- a/src/setup.cfg.m4
+++ b/src/setup.cfg.m4
@@ -26,7 +26,7 @@ classifiers =
     Topic :: Scientific/Engineering :: Mathematics
 
 [options]
-python_requires = >=3.7, <3.10
+python_requires = >=3.7, <3.11
 install_requires =
     sage_conf
     esyscmd(`sage-get-system-packages install-requires \
-- 
cgit v1.0-1-gd88e


From cb305525af1f872d00bb63387f7c68b88fb70a38 Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Fri, 17 Dec 2021 09:38:43 -0800
Subject: build/pkgs/python3/spkg-configure.m4: Warn on system python 3.10.x

---
 build/pkgs/python3/spkg-configure.m4 | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/build/pkgs/python3/spkg-configure.m4 b/build/pkgs/python3/spkg-configure.m4
index 3cbb994..5e3481a 100644
--- a/build/pkgs/python3/spkg-configure.m4
+++ b/build/pkgs/python3/spkg-configure.m4
@@ -1,6 +1,7 @@
 SAGE_SPKG_CONFIGURE([python3], [
    m4_pushdef([MIN_VERSION],               [3.7.0])
    m4_pushdef([MIN_NONDEPRECATED_VERSION], [3.7.0])
+   m4_pushdef([LT_STABLE_VERSION],         [3.10.0])
    m4_pushdef([LT_VERSION],                [3.11.0])
    AC_ARG_WITH([python],
                [AS_HELP_STRING([--with-python=PYTHON3],
@@ -116,6 +117,10 @@ and will be removed in the next development cycle.  Consider using a newer versi
 that may be available on your system or can be installed using the system package manager.
 To build Sage with a different system python, use ./configure --with-python=/path/to/python])
         ])
+        AX_COMPARE_VERSION([$python3_version], [ge], LT_STABLE_VERSION, [
+            AC_MSG_WARN([Support for system python >= LT_STABLE_VERSION is experimental.
+To build Sage with a different system python, use ./configure --with-python=/path/to/python])
+        ])
     ])
     AC_SUBST([PYTHON_FOR_VENV])
 
-- 
cgit v1.0-1-gd88e


From 249357dd30c54162e4b9204d6113c70b310a5087 Mon Sep 17 00:00:00 2001
From: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date: Sat, 18 Dec 2021 13:35:21 -0800
Subject: sage.cpython.atexit: fix for python 3.10 (#30766)

---
 src/sage/cpython/atexit.pyx | 75 +++++++++++++++++++++++++++++----------------
 1 file changed, 48 insertions(+), 27 deletions(-)

diff --git a/src/sage/cpython/atexit.pyx b/src/sage/cpython/atexit.pyx
index 5b0c6d1..3ba391b 100644
--- a/src/sage/cpython/atexit.pyx
+++ b/src/sage/cpython/atexit.pyx
@@ -144,43 +144,63 @@ cdef class restore_atexit:
 
 from cpython.ref cimport PyObject
 
-# Internal structures defined in the CPython source in
-# Modules/atexitmodule.c and subject to (but unlikely to) change.  Watch
-# https://bugs.python.org/issue32082 for a request to (eventually)
-# re-expose more of the atexit module's internals to Python
-ctypedef struct atexit_callback:
-    PyObject* func
-    PyObject* args
-    PyObject* kwargs
-
-
-ctypedef struct atexitmodule_state:
-    atexit_callback** atexit_callbacks
-    int ncallbacks
-    int callback_len
-
-
-cdef extern from "Python.h":
-    void* PyModule_GetState(object module)
-
+# Implement "_atexit_callbacks()" for each supported python version
+cdef extern from *:
+    """
+    #if PY_VERSION_HEX >= 0x030a0000
+    /********** Python 3.10 **********/
+    #define Py_BUILD_CORE
+    #undef _PyGC_FINALIZED
+    #include "internal/pycore_interp.h"
+    #include "internal/pycore_pystate.h"
+    static atexit_callback ** _atexit_callbacks(PyObject *self) {
+        PyInterpreterState *interp = _PyInterpreterState_GET();
+        struct atexit_state state = interp->atexit;
+        return state.callbacks;
+    }
+    #else
+    /********** Python < 3.10 **********/
+    /* Internal structures defined in the CPython source in
+     * Modules/atexitmodule.c and subject to (but unlikely to) change.  Watch
+     * https://bugs.python.org/issue32082 for a request to (eventually)
+     * re-expose more of the atexit module's internals to Python
+     * typedef struct
+     */
+    typedef struct {
+        PyObject *func;
+        PyObject *args;
+        PyObject *kwargs;
+    } atexit_callback;
+    typedef struct {
+        atexit_callback **atexit_callbacks;
+        int ncallbacks;
+        int callback_len;
+    } atexitmodule_state;
+    static atexit_callback ** _atexit_callbacks(PyObject *self) {
+        atexitmodule_state *state = PyModule_GetState(self);
+        return state->atexit_callbacks;
+    }
+    #endif
+    """
+    ctypedef struct atexit_callback:
+        PyObject* func
+        PyObject* args
+        PyObject* kwargs
+    atexit_callback** _atexit_callbacks(object module)
 
 def _get_exithandlers():
     """Return list of exit handlers registered with the atexit module."""
-    cdef atexitmodule_state* state
+    cdef atexit_callback ** callbacks
     cdef atexit_callback callback
     cdef list exithandlers
     cdef int idx
     cdef object kwargs
 
-    state = <atexitmodule_state*>PyModule_GetState(atexit)
-
-    if not state:
-        raise RuntimeError("atexit module state missing or corrupt")
-
     exithandlers = []
+    callbacks = _atexit_callbacks(atexit)
 
-    for idx in range(state.ncallbacks):
-        callback = state.atexit_callbacks[idx][0]
+    for idx in range(atexit._ncallbacks()):
+        callback = callbacks[idx][0]
         if callback.kwargs:
             kwargs = <object>callback.kwargs
         else:
@@ -207,4 +227,5 @@ def _set_exithandlers(exithandlers):
 
 def _clear_exithandlers():
     """Clear the atexit module of all registered exit handlers."""
+
     atexit._clear()
-- 
cgit v1.0-1-gd88e


From df9f1d4ced4264f65ab704f725f6f5879b012796 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Gonzalo=20Tornar=C3=ADa?= <tornaria@cmat.edu.uy>
Date: Sun, 19 Dec 2021 22:36:44 -0300
Subject: Pass float(0.5) to time.sleep

Since python 3.10, passing RealNumber breaks.
---
 src/sage_docbuild/utils.py | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/sage_docbuild/utils.py b/src/sage_docbuild/utils.py
index 956d703f..3e4793e 100644
--- a/src/sage_docbuild/utils.py
+++ b/src/sage_docbuild/utils.py
@@ -79,7 +79,7 @@ def build_many(target, args, processes=None):
         ....:         # Task 4 is a poison pill
         ....:         1 / 0
         ....:     else:
-        ....:         time.sleep(0.5)
+        ....:         time.sleep(float(0.5))
         ....:         print('Processed task %s' % N)
         ....:
 
@@ -104,7 +104,7 @@ def build_many(target, args, processes=None):
         ....:         # Task 4 is a poison pill
         ....:         os.kill(os.getpid(), signal.SIGKILL)
         ....:     else:
-        ....:         time.sleep(0.5)
+        ....:         time.sleep(float(0.5))
         ....:         print('Processed task %s' % N)
         ....:
         sage: build_many(target, range(8), processes=8)
-- 
cgit v1.0-1-gd88e

