From e2adfb1efbc76a439ddc7c028288e3f011244878 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fran=C3=A7ois=20Bissey?= <frp.bissey@gmail.com>
Date: Mon, 13 Dec 2021 11:18:44 +1300
Subject: Update sphinx to 4.3.1

---
 build/pkgs/sphinx/checksums.ini        | 6 +++---
 build/pkgs/sphinx/install-requires.txt | 2 +-
 build/pkgs/sphinx/package-version.txt  | 2 +-
 3 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/build/pkgs/sphinx/checksums.ini b/build/pkgs/sphinx/checksums.ini
index f7ba552..02fcbde 100644
--- a/build/pkgs/sphinx/checksums.ini
+++ b/build/pkgs/sphinx/checksums.ini
@@ -1,5 +1,5 @@
 tarball=Sphinx-VERSION.tar.gz
-sha1=b7d3ad1e91059d62044a3296112fa6662a38f089
-md5=6af34550e36dd6d58a496e47ec67280f
-cksum=1867791932
+sha1=f1c33352c018a5a3df39d5f01c3e38c8c063d6c9
+md5=08f6589fa8ab57fd36f0f80d1079b233
+cksum=2796062391
 upstream_url=https://pypi.io/packages/source/s/sphinx/Sphinx-VERSION.tar.gz
diff --git a/build/pkgs/sphinx/install-requires.txt b/build/pkgs/sphinx/install-requires.txt
index 0c661b6..0a751b2 100644
--- a/build/pkgs/sphinx/install-requires.txt
+++ b/build/pkgs/sphinx/install-requires.txt
@@ -1 +1 @@
-sphinx >=4, <4.3
+sphinx >=4.3, <4.4
diff --git a/build/pkgs/sphinx/package-version.txt b/build/pkgs/sphinx/package-version.txt
index 6aba2b2..f77856a 100644
--- a/build/pkgs/sphinx/package-version.txt
+++ b/build/pkgs/sphinx/package-version.txt
@@ -1 +1 @@
-4.2.0
+4.3.1
-- 
cgit v1.0-1-gd88e


From efb00a873b766b6e2be4be9818f2e9bedb6a9238 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fran=C3=A7ois=20Bissey?= <frp.bissey@gmail.com>
Date: Mon, 13 Dec 2021 11:19:13 +1300
Subject: update sphinx dependency list and special installation instructions

---
 build/pkgs/sphinx/SPKG.rst | 12 +-----------
 1 file changed, 1 insertion(+), 11 deletions(-)

diff --git a/build/pkgs/sphinx/SPKG.rst b/build/pkgs/sphinx/SPKG.rst
index 62a8ff0..2a34c9d 100644
--- a/build/pkgs/sphinx/SPKG.rst
+++ b/build/pkgs/sphinx/SPKG.rst
@@ -27,21 +27,11 @@ Upstream Contact
 Dependencies
 ------------
 
--  six >= 1.4
 -  Jinja2 >= 2.3
 -  Pygments >= 2.0
--  docutils >= 0.11
+-  docutils < 0.18
 -  snowballstemmer >= 1.1
 -  babel >= 1.3
 -  setuptools / distribute
 -  Python
 -  GNU patch (shipped with Sage)
-
-
-Special Update/Build Instructions
----------------------------------
-
--  The script create_grammar_pickle.py creates the file
-   Grammar2.7.pickle in site-packages/Sphinx-.../sphinx/pycode/. This
-   helps to avoid race conditions when building the documentation in
-   parallel.
-- 
cgit v1.0-1-gd88e


From 25cba02d3e5094b78ffbc66c38687e25caca2681 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fran=C3=A7ois=20Bissey?= <frp.bissey@gmail.com>
Date: Mon, 13 Dec 2021 11:20:17 +1300
Subject: add gentoo distros file

---
 build/pkgs/sphinx/distros/gentoo.txt | 1 +
 1 file changed, 1 insertion(+)
 create mode 100644 build/pkgs/sphinx/distros/gentoo.txt

diff --git a/build/pkgs/sphinx/distros/gentoo.txt b/build/pkgs/sphinx/distros/gentoo.txt
new file mode 100644
index 00000000..059e3ae
--- /dev/null
+++ b/build/pkgs/sphinx/distros/gentoo.txt
@@ -0,0 +1 @@
+dev-python/sphinx
-- 
cgit v1.0-1-gd88e


From fc84f82f52b6f05f512cb359ec7c100f93cf8841 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fran=C3=A7ois=20Bissey?= <frp.bissey@gmail.com>
Date: Mon, 13 Dec 2021 11:23:48 +1300
Subject: Add required new option for sphinx 4.3+ as per Tobias Hansen's
 original patch

---
 src/sage/docs/conf.py | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/sage/docs/conf.py b/src/sage/docs/conf.py
index f2efb65..0caac35 100644
--- a/src/sage/docs/conf.py
+++ b/src/sage/docs/conf.py
@@ -911,6 +911,7 @@ def setup(app):
     if app.srcdir.startswith(SAGE_DOC_SRC):
         app.add_config_value('intersphinx_mapping', {}, False)
         app.add_config_value('intersphinx_cache_limit', 5, False)
+        app.add_config_value('intersphinx_disabled_reftypes', [], False)
         app.connect('config-inited', set_intersphinx_mappings)
         app.connect('builder-inited', intersphinx.load_mappings)
         # We do *not* fully initialize intersphinx since we call it by hand
-- 
cgit v1.0-1-gd88e

